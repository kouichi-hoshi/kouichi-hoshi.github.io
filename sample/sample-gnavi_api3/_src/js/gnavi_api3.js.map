{"version":3,"sources":["gnavi_api3.js"],"names":["gVar","bp_xs","bp_sm","bp_md","bp_lg","_ua","u","Tablet","indexOf","Mobile","window","navigator","userAgent","toLowerCase","hit_per_page_num","offset_page_num","pref_name_ini","pref_name","freeword","getDataCount","container","category_l","endPoints","rest","pref","css","cls","params","keyid","format","optsRest","hit_per_page","offset_page","Object","assign","getAPIdata","data","view","count","total_hit_count","jQuery","html","i","elm","name","shop_image1","image_url","url","address","keys","length","append","img_li","console","log","after","addClass","pref_title","val","code","pref_code","category_l_code","category_l_name","one","getJSON","_showResultNum","_getData","_farstPrefTitle","_createPrefSelector","_createClsRadioBtn","on","remove","empty","out","$","serializeObject","selectPref_name","text","_changePrefTitle","removeClass"],"mappings":"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","file":"gnavi_api3.js","sourcesContent":["/**\n * namespace\n */\n\nvar gVar = gVar || {};\ngVar.bp_xs    = 480;\ngVar.bp_sm    = 768;\ngVar.bp_md    = 992;\ngVar.bp_lg    = 1200;\n\n//ユーザーエージェントを取得してデバイスを判定 https://w3g.jp/blog/js_browser_sniffing2015\nvar _ua = (function(u){\n\treturn {\n\t\tTablet:(u.indexOf(\"windows\") != -1 && u.indexOf(\"touch\") != -1) || u.indexOf(\"ipad\") != -1 || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") == -1) || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"tablet\") != -1) || u.indexOf(\"kindle\") != -1 || u.indexOf(\"silk\") != -1 || u.indexOf(\"playbook\") != -1,\n\t\tMobile:(u.indexOf(\"windows\") != -1 && u.indexOf(\"phone\") != -1) || u.indexOf(\"iphone\") != -1 || u.indexOf(\"ipod\") != -1 || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") != -1) || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"mobile\") != -1) || u.indexOf(\"blackberry\") != -1\n\t};\n})(window.navigator.userAgent.toLowerCase());\n\n\n\n/**\n *　API 初期設定\n */\n\n// 初期値\nlet hit_per_page_num = 10; //一度に表示する件数\nlet offset_page_num = 1; //初期ページ\nlet pref_name_ini = 12; //都道府県初期設定 (PREF13=東京都)\nlet pref_name = 'PREF' + (pref_name_ini + 1); //都道府県名キー作成\nlet freeword = 'コーヒー,カフェ,珈琲,喫茶,喫茶店';\nlet getDataCount = 0; //店舗データ数判定\nlet container = '.result'; //wrapper要素指定\nlet category_l = '';\n\n\n// エンドポイント\ngVar.endPoints = {\n\trest : 'http://api.gnavi.co.jp/RestSearchAPI/20150630/?callback=?', //レストラン検索API\n\tpref : 'http://api.gnavi.co.jp/master/PrefSearchAPI/20150630/?callback=?', //エリアマスタ取得API\n\tcss  : 'http://api.gnavi.co.jp/master/CategorySmallSearchAPI/20150630/?callback=?', //小業態マスタ取得API\t\t\t\t\n\tcls  : 'http://api.gnavi.co.jp/master/CategoryLargeSearchAPI/20150630/?callback=?' //大業態マスタ取得API\n\n}\n\n// 基本パラメータ\ngVar.params = {\n\tkeyid: 'a6154b84e515ec01816a2abfe80fc329',\n\tformat: 'json',\n}\n\n// カスタムパラメータ レストラン検索用\ngVar.optsRest = {\n\tpref: pref_name,\n//\tfreeword: freeword, //キーワード設定\n\thit_per_page: hit_per_page_num, //表示件数\n\toffset_page: offset_page_num, //ページ数初期化\n\tcategory_l: category_l,\n}\n\ngVar.rest = Object.assign({}, gVar.params, gVar.optsRest);\n\n\nclass getAPIdata{\n\n\t// constructor(getDataCount){\n\t// \tthis.getDataCount = getDataCount;\n\t// \tthis.paramsOpts = paramsOpts;\n\t// }\n\n\t_showResultNum(data, view){\n\t\tlet count = data.total_hit_count;\n\t\tif ( count > 0 ) {\n\t\t\tjQuery(view).html(count + '件のお店が見つかりました。');\n\t\t} else {\n\t\t\tjQuery(view).html('お店が見つかりませんでした。');\n\t\t}\n\t}\n\n\t//店舗データ取得\n\t_getData(data){\n\n\t\tfor ( let i in data.rest ){\n\n\t\t\tlet elm = {\n\t\t\t\tname: data.rest[i].name,\n\t\t\t\tshop_image1: data.rest[i].image_url.shop_image1,\n\t\t\t\turl: data.rest[i].url,\n\t\t\t\taddress:data.rest[i].address\n\t\t\t}\n\n\t\t\tif(Object.keys(elm.shop_image1).length === 0){\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t} else {\n\t\t\t\tlet img_li = '<img class=\"fluid_img\" src=\"' + elm.shop_image1 + '\" />' + '<br />';\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + img_li + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t}\n\n\t\t\t//取得データカウント更新\n\t\t\tgetDataCount++;\n\t\t\tconsole.log('取得データ数: ' + getDataCount);\n\n\t\t\t//全データ取得時メッセージ\n\t\t\tif ( getDataCount >= data.total_hit_count ){\n\t\t\t\tjQuery('.btn--more-load').after('<p class=\"vew-end\">全データを表示しました。</p>').addClass('none');\n\t\t\t}\n\n\t\t}\n\n\t\t//ページ数をアップデート\n\t\tgVar.rest.offset_page++;\n\t\tconsole.log('ページ数更新値： ' + gVar.rest.offset_page);\n\n\t}\n\n\n\n\n\t// API 地域名初期表示\n\t_farstPrefTitle(data){\n\t\tvar pref_title = data.pref[pref_name_ini].pref_name;\n\t\tjQuery('.pref_title').html(pref_title);\n\t}\n\n\t//現在の地域名を更新\n\t_changePrefTitle(val){\n\t\tjQuery('.pref_title').html(val);\t\t\n\t}\n\n\t//API 都道府県データをselect要素として生成する\n\t_createPrefSelector(data){\n\t\tfor ( var i in data.pref ){\n\t\t\tvar name = data.pref[i].pref_name;\n\t\t\tvar code = data.pref[i].pref_code;\n\t\t\tjQuery(\"[name = pref_name]\").append( '<option value=\"' + code + '\">' + name + '</option>' );\n\t\t}\n\t}\n\n\t_createClsRadioBtn(data){\n\t\tconsole.log(data.category_l[0].category_l_code);\n\t\tfor ( var i in data.category_l){\n\t\t\tvar code = data.category_l[i].category_l_code;\n\t\t\tvar name = data.category_l[i].category_l_name;\n\t\t\tjQuery('.block-cls').append('<label><input type=\"radio\" name=\"cls\" value=\"' + code + '\">' + name + '</label>');\n\t\t}\n\t}\n\n\n\n\n}\n\n\n\n\njQuery(function() {\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\nlet rest = new getAPIdata();\n\n\n//ページがロードされたら\njQuery(window).one('load', function(){\n\n\tconsole.log('ページ数更新値： ' + gVar.rest.offset_page);\n\n\t//レストラン検索\n\tjQuery.getJSON(gVar.endPoints.rest, gVar.rest, function(data){\n\t\tconsole.log(data);\n\n\t\trest._showResultNum(data, '.total'); //店舗件数を表示\n\n\t\trest._getData(data); //店舗データ表示\n\n\t})\n\n\t//都道府県マスタ\n\tjQuery.getJSON(gVar.endPoints.pref, gVar.params, function(data){\n\t\tconsole.log(data);\n\t\trest._farstPrefTitle(data); //地域名を表示\n\t\trest._createPrefSelector(data); //地域選択select要素を作成\n\t})\n\n\t//小業態マスタ\n\tjQuery.getJSON(gVar.endPoints.css, gVar.params, function(data){\n\t\tconsole.log(data);\n\t})\n\n\t//大業態マスタ\n\tjQuery.getJSON(gVar.endPoints.cls, gVar.params, function(data){\n\t\t//console.log(data);\n\t\trest._createClsRadioBtn(data);\n\t})\n\n});\n\n\n\n//指定要素がクリックされたら次のデータを取得し表示する\njQuery('.btn--more-load').on('click', function(){\n\n\t//レストラン検索\n\tjQuery.getJSON(gVar.endPoints.rest, gVar.rest, function(data){\n\n\t\t//店舗データ表示\n\t\trest._getData(data);\n\n\t})\n\n});\n\n//指定要素がクリックされたら都道府県を変更して店舗データを再取得し表示する\njQuery('[name = pref_btn]').on('click', function(){\n\n\tconsole.log(gVar.rest);\n\n\t//初期化処理\n\tjQuery('.vew-end').remove();　//「全データ取得済み」表示を削除\n\tgetDataCount = 0;　//店舗データ数判定を初期化\n\tjQuery(container).empty();　//商品データ一覧を初期化\n\tgVar.rest.offset_page = 1;　//ページ数を初期化\n\n\n\t// form要素から取得した値をオブジェクトで取得\n\tvar out = $('.pref_search').serializeObject();\n\n\t//取得した値をエンドポイントのパラメータにセット\n\n\tgVar.rest.pref       = out.pref_name; //都道府県コード\n\tgVar.rest.category_l = out.cls; //大業態コード\n\n\n\t\n\t//<select name=\"pref_name\">で選択されている要素(都道府県名)を取得\n\tlet selectPref_name = jQuery('[name = pref_name] option:selected').text();\n\n\t//現在の地域名表示をアップデート\n\trest._changePrefTitle(selectPref_name);\n\n\t//APIデータを取得\n\tjQuery.getJSON(gVar.endPoints.rest, gVar.rest, function(data){\n\n\t\t// 店舗件数を表示\n\t\trest._showResultNum(data, '.total');\n\n\t\t// 店舗データ表示\n\t\trest._getData(data);\n\n\t})\n\n\t//データ取得ボタンを再表示\n\tjQuery('.btn--more-load').removeClass('none');\n\n});\n\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n});"]}