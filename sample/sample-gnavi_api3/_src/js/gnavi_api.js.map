{"version":3,"sources":["gnavi_api.js"],"names":["jQuery","$container","$inner","api_key","hit_per_page_num","offset_page_num","pref_name_ini","pref_name_key","url_rest","url_pref","params","keyid","format","params_shop","extend","pref","freeword","hit_per_page","offset_page","resultLooplength","preLoad","imagesLoaded","masonry","itemSelector","isFitWidth","isAnimated","resultLoop","result","i","rest","elm","name","shop_image1","image_url","url","address","img_url","toString","append","img_li","total_hit_count","after","addClass","resultNum","html","farstPrefTitle","pref_title","pref_name","changePrefTitle","val","resultPref","code","pref_code","window","one","getJSON","on","remove","removeClass","pref_val","selectPref_name","text","empty","call"],"mappings":"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","file":"gnavi_api.js","sourcesContent":["jQuery(function() {\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\n\n(function(){\n\n\t/**************************************************************************************\n\t * 変数定義\n\t **************************************************************************************/\n\n\t// masonry 初期設定\n\tvar $container = jQuery('.grid'); //wrapper要素指定\n\tvar $inner = '.grid-item'; //inner要素指定\n\n\t// API\n\tvar api_key = 'a6154b84e515ec01816a2abfe80fc329'; //アクセスキー\n\tvar hit_per_page_num = 10; //一度に表示する件数\n\tvar offset_page_num = 1; //初期ページ\n\tvar pref_name_ini = 13; //都道府県初期設定 (PREF13=東京都)\n\tvar pref_name_key = 'PREF' + pref_name_ini; //都道府県名キー作成\n\n\t// API URL\n\tvar url_rest = 'http://api.gnavi.co.jp/RestSearchAPI/20150630/?callback=?'; //レストラン検索API\n\tvar url_pref = 'http://api.gnavi.co.jp/master/PrefSearchAPI/20150630/?callback=?'; //エリアマスタ取得API\n\n\t//API 基本パラメータ\n\tvar params = {\n\t\tkeyid: api_key,\n\t\tformat: 'json'\n\t};\n\n\t// API 店舗データ取得用パラメータ設定\n\tvar params_shop = jQuery.extend({ }, params);\n\tparams_shop.pref = pref_name_key; //都道府県設定\n\tparams_shop.freeword = 'コーヒー,カフェ,珈琲,喫茶,喫茶店'; //キーワード設定\n\tparams_shop.hit_per_page = hit_per_page_num;\n\tparams_shop.offset_page = offset_page_num; //ページ数\n\n\t//店舗データ数判定\n\tvar resultLooplength = 0;\n\n\n\n\t/**************************************************************************************\n\t * masonry　データ配置処理\n\t **************************************************************************************/\n\n\tvar preLoad = function(){\n\t\t$container.imagesLoaded(function(){\n\t\t\t$container.masonry({\n\t\t\t\titemSelector: $inner,　//タイトル状に配置する要素のclassの指定\n\t\t\t\tisFitWidth: true,　//親要素の幅に合わせてタイル状のコンテンツ数を自動調整\n\t\t\t\tisAnimated: false　//伸縮時のアニメーションの設定\n\t\t\t});\n\t\t});\n\t};\n\n\n\n\t/**************************************************************************************\n\t * API 店舗データ 出力\n\t **************************************************************************************/\n\n\n\t//API 店舗データ出力\n\tvar resultLoop = function(result){\n\n\t\tfor ( var i in result.rest ){\n\n\t\t\tvar elm = {\n\t\t\t\tname: result.rest[i].name,\n\t\t\t\tshop_image1: result.rest[i].image_url.shop_image1,\n\t\t\t\turl: result.rest[i].url,\n\t\t\t\taddress:result.rest[i].address\n\t\t\t}\n\n\t\t\tvar img_url = elm.shop_image1.toString();\n\n\t\t\tif(img_url === '[object Object]'){\n\t\t\t\tpreLoad();\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t} else {\n\t\t\t\tvar img_li = '<img class=\"fluid_img\" src=\"' + elm.shop_image1 + '\" />' + '<br />';\n\t\t\t\tpreLoad();\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + img_li + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t}\n\n\t\t\tresultLooplength++;\n\n\t\t\tif( resultLooplength >= result.total_hit_count ){\n\t\t\t\tjQuery('.btn--more-load').after('<p class=\"vew-end\">全データを表示しました。</p>').addClass('none')/*.remove()*/;\n\t\t\t\tresultLooplength = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tparams_shop.offset_page++;\n\n\t};\n\n\t//API　取得件数を表示\n\tvar resultNum = function(result){\n\t\tif ( result.total_hit_count > 0 ) {\n\t\t\tjQuery('.total').html( result.total_hit_count + '件のお店が見つかりました。\\n' );\n\t\t} else {\n\t\t\tjQuery('.total').html( 'お店が見つかりませんでした。' );\n\t\t}\n\t};\n\n\n\n\t/**************************************************************************************\n\t * API 都道府県データ 出力\n\t **************************************************************************************/\n\n\t// API 地域名初期表示\n\tvar farstPrefTitle = function(result){\n\t\tvar pref_title = result.pref[pref_name_ini - 1].pref_name;\n\t\tjQuery('.pref_title').html(pref_title);\n\t};\n\n\t//現在の地域名を更新\n\tvar changePrefTitle = function(val,result){\n\t\tjQuery('.pref_title').html(val);\t\t\n\t};\n\n\t//API 都道府県データをselect要素として生成する\n\tvar resultPref = function(result){\n\t\tfor ( var i in result.pref ){\n\t\t\tvar name = result.pref[i].pref_name;\n\t\t\tvar code = result.pref[i].pref_code;\n\t\t\tjQuery(\"[name = pref_name]\").append( '<option value=\"' + code + '\">' + name + '</option>' );\n\t\t}\n\t};\n\n\n\n\n\t/**************************************************************************************\n\t * APIデータ取得/イベント実行\n\t **************************************************************************************/\n\n\t//ページがロードされたら\n\tjQuery(window).one('load', function(){\n\n\t\t//店舗データを取得し表示する\n\t\tjQuery.getJSON(url_rest, params_shop, function(result){\n\n\t\t\t//店舗件数を表示\n\t\t\tresultNum(result);\n\n\t\t\t//店舗データ表示\n\t\t\tresultLoop(result);\n\n\t\t\t//ページ数を更新\n\t\t\toffset_page_num++;\n\n\t\t})\n\n\t\t//都道府県データを取得し表示/セットする\n\t\tjQuery.getJSON(url_pref, params, function(result){\n\t\t\tfarstPrefTitle(result);\n\t\t\tresultPref(result);\n\t\t})\n\n\t});\n\n\t//指定要素がクリックされたら次のデータを取得し表示する\n\tjQuery('.btn--more-load').on('click', function(){\n\n\t\t//APIデータを取得\n\t\tjQuery.getJSON(url_rest, params_shop, function(result){\n\n\t\t\t//店舗データ表示\n\t\t\tresultLoop(result);\n\n\t\t\t//masonryを再配置\n\t\t\t$container.masonry('reloadItems');\n\n\t\t})\n\n\t});\n\n\n\t//指定要素がクリックされたら都道府県を変更して店舗データを再取得し表示する\n\tjQuery('[name = pref_btn]').on('click', function(){\n\n\t\t//店舗データ数判定を初期化する\n\t\tresultLooplength = 0;\n\n\t\t//「全データ取得済み」表示を削除する\n\t\tjQuery('.vew-end').remove();\n\n\t\t//データ取得ボタンを再表示する\n\t\tjQuery('.btn--more-load').removeClass('none');\n\n\t\t//<select name=\"pref_name\">で選択されているoption要素のvalue(都道府県パラメータ)を取得 \n\t\tvar pref_val = jQuery('[name = pref_name]').val();\n\t\t\n\t\t//<select name=\"pref_name\">で選択されている要素(都道府県名)を取得\n\t\tvar selectPref_name = jQuery('[name = pref_name] option:selected').text();\n\n\n\t\t//商品データ一覧を初期化\n\t\t$container.empty();\n\n\t\t//ページ数を初期化\n\t\tparams_shop.offset_page = 1;\n\n\t\t//都道府県パラメータを都道府県データ取得API用オブジェクトにセット\n\t\tparams_shop.pref = pref_val;\n\n\t\t//現在の地域名を更新\n\t\tchangePrefTitle(selectPref_name);\n\n\t\t//APIデータを取得\n\t\tjQuery.getJSON(url_rest, params_shop, function(result){\n\n\t\t\t//店舗件数を表示\n\t\t\tresultNum(result);\n\n\t\t\t//店舗データ表示\n\t\t\tresultLoop(result);\n\n\t\t\t//masonryを再配置\n\t\t\t$container.masonry('reloadItems');\n\n\t\t})\n\n\t});\n\n\n}).call(this);\n\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n});"]}