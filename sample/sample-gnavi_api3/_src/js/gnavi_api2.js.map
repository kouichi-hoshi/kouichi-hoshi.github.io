{"version":3,"sources":["gnavi_api2.js"],"names":["gVar","bp_xs","bp_sm","bp_md","bp_lg","_ua","u","Tablet","indexOf","Mobile","window","navigator","userAgent","toLowerCase","getAPIdata","params","paramsOpts","jQuery","extend","data","c","total_hit_count","resultNum","console","log","view","show","_getResultNum","html","i","rest","elm","name","shop_image1","image_url","url","address","img_url","toString","append","img_li","valueUpdate","DataCountUp","getDataCount","after","addClass","offset_page","pref_title","pref","pref_num","pref_name","val","code","pref_code","endPoints","keyid","format","base","freeword","hit_per_page","restParameter","_getParameter","one","getJSON","_showResultNum","_getData","_farstPrefTitle","_dataPref","on"],"mappings":";;;;;;AAAA;;;;AAIA,IAAIA,OAAOA,QAAQ,EAAnB;AACAA,KAAKC,KAAL,GAAgB,GAAhB;AACAD,KAAKE,KAAL,GAAgB,GAAhB;AACAF,KAAKG,KAAL,GAAgB,GAAhB;AACAH,KAAKI,KAAL,GAAgB,IAAhB;;AAEA;AACA,IAAIC,MAAO,UAASC,CAAT,EAAW;AACrB,QAAO;AACNC,UAAQD,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,OAAV,KAAsB,CAAC,CAAtD,IAA4DF,EAAEE,OAAF,CAAU,MAAV,KAAqB,CAAC,CAAlF,IAAwFF,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAA9I,IAAqJF,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAA3M,IAAiNF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAAzO,IAA8OF,EAAEE,OAAF,CAAU,MAAV,KAAqB,CAAC,CAApQ,IAAyQF,EAAEE,OAAF,CAAU,UAAV,KAAyB,CAAC,CADpS;AAENC,UAAQH,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,OAAV,KAAsB,CAAC,CAAtD,IAA4DF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAApF,IAAyFF,EAAEE,OAAF,CAAU,MAAV,KAAqB,CAAC,CAA/G,IAAqHF,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAA3K,IAAkLF,EAAEE,OAAF,CAAU,SAAV,KAAwB,CAAC,CAAzB,IAA8BF,EAAEE,OAAF,CAAU,QAAV,KAAuB,CAAC,CAAxO,IAA8OF,EAAEE,OAAF,CAAU,YAAV,KAA2B,CAAC;AAF3Q,EAAP;AAIA,CALS,CAKPE,OAAOC,SAAP,CAAiBC,SAAjB,CAA2BC,WAA3B,EALO,CAAV;;IAaMC,U;AAEL,qBAAYC,MAAZ,EAAoBC,UAApB,EAA+B;AAAA;;AAC9B,OAAKD,MAAL,GAAkBA,MAAlB;AACA,OAAKC,UAAL,GAAkBA,UAAlB;AACA;;AAED;;;;;kCACe;AACd,UAAOC,OAAOC,MAAP,CAAc,EAAd,EAAmB,KAAKH,MAAxB,EAAgC,KAAKC,UAArC,CAAP;AACA;;AAED;;;;gCACcG,I,EAAK;AAClB,OAAIC,IAAID,KAAKE,eAAb;AACA,OAAKD,IAAI,CAAT,EAAa;AACZ,QAAIE,YAAYF,IAAI,eAApB;AACAG,YAAQC,GAAR,CAAYF,SAAZ;AACA,WAAOA,SAAP;AACA,IAJD,MAIO;AACN,WAAO,gBAAP;AACA;AACD;;;iCAEcH,I,EAAMM,I,EAAK;AACzB,OAAIC,OAAO,KAAKC,aAAL,CAAmBR,IAAnB,CAAX;AACAF,UAAOQ,IAAP,EAAaG,IAAb,CAAkBF,IAAlB;AACA;;AAED;;;;2BACSP,I,EAAK;;AAEb,QAAM,IAAIU,CAAV,IAAeV,KAAKW,IAApB,EAA0B;;AAEzB,QAAIC,MAAM;AACTC,WAAMb,KAAKW,IAAL,CAAUD,CAAV,EAAaG,IADV;AAETC,kBAAad,KAAKW,IAAL,CAAUD,CAAV,EAAaK,SAAb,CAAuBD,WAF3B;AAGTE,UAAKhB,KAAKW,IAAL,CAAUD,CAAV,EAAaM,GAHT;AAITC,cAAQjB,KAAKW,IAAL,CAAUD,CAAV,EAAaO;AAJZ,KAAV;;AAOA,QAAIC,UAAUN,IAAIE,WAAJ,CAAgBK,QAAhB,EAAd;;AAEA,QAAGD,YAAY,iBAAf,EAAiC;AAChCpB,YAAO,SAAP,EAAkBsB,MAAlB,CAAyB,oCAAoCR,IAAII,GAAxC,GAA8C,IAA9C,GAAqDJ,IAAIC,IAAzD,GAAgE,QAAhE,GAA2ED,IAAIK,OAA/E,GAAyF,WAAlH;AACA,KAFD,MAEO;AACN,SAAII,SAAS,iCAAiCT,IAAIE,WAArC,GAAmD,MAAnD,GAA4D,QAAzE;AACAhB,YAAO,SAAP,EAAkBsB,MAAlB,CAAyB,oCAAoCR,IAAII,GAAxC,GAA8C,IAA9C,GAAqDK,MAArD,GAA8DT,IAAIC,IAAlE,GAAyE,QAAzE,GAAoFD,IAAIK,OAAxF,GAAkG,WAA3H;AACA;;AAED;AACApC,SAAKyC,WAAL,CAAiBC,WAAjB;AACAnB,YAAQC,GAAR,CAAY,aAAaxB,KAAKyC,WAAL,CAAiBC,WAA1C;;AAEA;AACA,QAAI1C,KAAKyC,WAAL,CAAiBE,YAAjB,IAAiCxB,KAAKE,eAA1C,EAA2D;AAC1DJ,YAAO,iBAAP,EAA0B2B,KAA1B,CAAgC,qCAAhC,EAAuEC,QAAvE,CAAgF,MAAhF,EAAuF,aAAvF;AACA7C,UAAKyC,WAAL,CAAiBE,YAAjB,GAAgC,CAAhC;AACA;AAED;;AAED;AACA3C,QAAKyC,WAAL,CAAiBK,WAAjB;AACAvB,WAAQC,GAAR,CAAY,cAAcxB,KAAKyC,WAAL,CAAiBK,WAA3C;AAEA;;;;;AAKD;kCACgB3B,I,EAAK;AACpB,OAAI4B,aAAa5B,KAAK6B,IAAL,CAAUhD,KAAKyC,WAAL,CAAiBQ,QAA3B,EAAqCC,SAAtD;AACAjC,UAAO,aAAP,EAAsBW,IAAtB,CAA2BmB,UAA3B;AACA;;;;;AAED;mCACiB5B,I,EAAK;AACrBF,UAAO,aAAP,EAAsBW,IAAtB,CAA2BuB,GAA3B;AACA;;;;;AAED;4BACUhC,I,EAAK;AACd,QAAM,IAAIU,CAAV,IAAeV,KAAK6B,IAApB,EAA0B;AACzB,QAAIhB,OAAOb,KAAK6B,IAAL,CAAUnB,CAAV,EAAaqB,SAAxB;AACA,QAAIE,OAAOjC,KAAK6B,IAAL,CAAUnB,CAAV,EAAawB,SAAxB;AACApC,WAAO,oBAAP,EAA6BsB,MAA7B,CAAqC,oBAAoBa,IAApB,GAA2B,IAA3B,GAAkCpB,IAAlC,GAAyC,WAA9E;AACA;AACD;;;;;;AAWFf,OAAO,YAAW;AAClB;;;AAIA;;;;AAIA;AACAjB,MAAKsD,SAAL,GAAiB;AAChBxB,QAAO,2DADS,EACoD;AACpEkB,QAAO,kEAFS,EAAjB;;AAKA;AACAhD,MAAKe,MAAL,GAAc;AACbwC,SAAO,kCADM;AAEbC,UAAQ;AAFK,EAAd;;AAKA;AACAxD,MAAKyC,WAAL,GAAmB;AAClBK,eAAa,CADK,EACF;AAChBJ,eAAa,CAFK,EAEF;AAChBO,YAAU,EAHQ,CAGL;AAHK,EAAnB;;AAMA;AACAjD,MAAKgB,UAAL,GAAkB;;AAEjByC,QAAM;AACLC,aAAU,oBADL,EAC2B;AAChCC,iBAAc,EAFT,EAEa;AAClBX,SAAM,UAAUhD,KAAKyC,WAAL,CAAiBQ,QAAjB,GAA4B,CAAtC,CAHD,CAG0C;AAH1C;;AAFW,EAAlB;;AAWA1B,SAAQC,GAAR,CAAYxB,KAAKyC,WAAL,CAAiBQ,QAA7B;;AAGA;;;AAGA,KAAInB,OAAO,IAAIhB,UAAJ,CAAed,KAAKe,MAApB,EAA4Bf,KAAKgB,UAAL,CAAgByC,IAA5C,CAAX;AACA,KAAIG,gBAAgB9B,KAAK+B,aAAL,EAApB;;AAEA,KAAIb,OAAO,IAAIlC,UAAJ,CAAed,KAAKe,MAApB,CAAX;;AAGA;AACAE,QAAOP,MAAP,EAAeoD,GAAf,CAAmB,MAAnB,EAA2B,YAAU;;AAEpCvC,UAAQC,GAAR,CAAY,cAAcxB,KAAKyC,WAAL,CAAiBK,WAA3C;;AAEA;;;AAGA7B,SAAO8C,OAAP,CAAe/D,KAAKsD,SAAL,CAAexB,IAA9B,EAAoC8B,aAApC,EAAmD,UAASzC,IAAT,EAAc;;AAEhE;AACAW,QAAKkC,cAAL,CAAoB7C,IAApB,EAA0B,QAA1B;;AAEA;AACAW,QAAKmC,QAAL,CAAc9C,IAAd;AAEA,GARD;;AAUA;AACAF,SAAO8C,OAAP,CAAe/D,KAAKsD,SAAL,CAAeN,IAA9B,EAAoChD,KAAKe,MAAzC,EAAiD,UAASI,IAAT,EAAc;AAC9DI,WAAQC,GAAR,CAAYL,IAAZ;AACA6B,QAAKkB,eAAL,CAAqB/C,IAArB;AACA6B,QAAKmB,SAAL,CAAehD,IAAf;AACA,GAJD;AAMA,EAxBD;;AA4BA;AACAF,QAAO,iBAAP,EAA0BmD,EAA1B,CAA6B,OAA7B,EAAsC,YAAU;;AAE/C;AACAnD,SAAO8C,OAAP,CAAe/D,KAAKsD,SAAL,CAAexB,IAA9B,EAAoC8B,aAApC,EAAmD,UAASzC,IAAT,EAAc;;AAEhE;AACAW,QAAKmC,QAAL,CAAc9C,IAAd;;AAEA;AACAnB,QAAKyC,WAAL,CAAiBK,WAAjB;AAGA,GATD;AAWA,EAdD;;AAiBA;AACC,CApGD","file":"gnavi_api2.js","sourcesContent":["/**\n * namespace\n */\n\nvar gVar = gVar || {};\ngVar.bp_xs    = 480;\ngVar.bp_sm    = 768;\ngVar.bp_md    = 992;\ngVar.bp_lg    = 1200;\n\n//ユーザーエージェントを取得してデバイスを判定 https://w3g.jp/blog/js_browser_sniffing2015\nvar _ua = (function(u){\n\treturn {\n\t\tTablet:(u.indexOf(\"windows\") != -1 && u.indexOf(\"touch\") != -1) || u.indexOf(\"ipad\") != -1 || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") == -1) || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"tablet\") != -1) || u.indexOf(\"kindle\") != -1 || u.indexOf(\"silk\") != -1 || u.indexOf(\"playbook\") != -1,\n\t\tMobile:(u.indexOf(\"windows\") != -1 && u.indexOf(\"phone\") != -1) || u.indexOf(\"iphone\") != -1 || u.indexOf(\"ipod\") != -1 || (u.indexOf(\"android\") != -1 && u.indexOf(\"mobile\") != -1) || (u.indexOf(\"firefox\") != -1 && u.indexOf(\"mobile\") != -1) || u.indexOf(\"blackberry\") != -1\n\t};\n})(window.navigator.userAgent.toLowerCase());\n\n\n\n\n\n\n\t\nclass getAPIdata{\n\n\tconstructor(params, paramsOpts){\n\t\tthis.params     = params;\n\t\tthis.paramsOpts = paramsOpts;\n\t}\n\n\t//パラメーターをマージ\n\t_getParameter(){\n\t\treturn jQuery.extend({ }, this.params, this.paramsOpts);\n\t}\n\n\t// 取得件数を表示\n\t_getResultNum(data){\n\t\tlet c = data.total_hit_count;\n\t\tif ( c > 0 ) {\n\t\t\tlet resultNum = c + '件のお店が見つかりました。';\n\t\t\tconsole.log(resultNum);\n\t\t\treturn resultNum;\n\t\t} else {\n\t\t\treturn 'お店が見つかりませんでした。';\n\t\t}\n\t}\n\n\t_showResultNum(data, view){\n\t\tlet show = this._getResultNum(data);\n\t\tjQuery(view).html(show);\n\t}\n\n\t//店舗データ取得\n\t_getData(data){\n\n\t\tfor ( var i in data.rest ){\n\n\t\t\tvar elm = {\n\t\t\t\tname: data.rest[i].name,\n\t\t\t\tshop_image1: data.rest[i].image_url.shop_image1,\n\t\t\t\turl: data.rest[i].url,\n\t\t\t\taddress:data.rest[i].address\n\t\t\t}\n\n\t\t\tvar img_url = elm.shop_image1.toString();\n\n\t\t\tif(img_url === '[object Object]'){\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t} else {\n\t\t\t\tvar img_li = '<img class=\"fluid_img\" src=\"' + elm.shop_image1 + '\" />' + '<br />';\n\t\t\t\tjQuery('.result').append('<li class=\"grid-item\"><a href=\"' + elm.url + '\">' + img_li + elm.name + '<br />' + elm.address + '</a></li>');\n\t\t\t}\n\n\t\t\t//取得データカウント更新\n\t\t\tgVar.valueUpdate.DataCountUp++;\n\t\t\tconsole.log('取得データ数: ' + gVar.valueUpdate.DataCountUp);\n\n\t\t\t//全データ取得時メッセージ\n\t\t\tif( gVar.valueUpdate.getDataCount >= data.total_hit_count ){\n\t\t\t\tjQuery('.btn--more-load').after('<p class=\"vew-end\">全データを表示しました。</p>').addClass('none')/*.remove()*/;\n\t\t\t\tgVar.valueUpdate.getDataCount = 0;\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\tgVar.valueUpdate.offset_page++;\n\t\tconsole.log('ページ数更新値： ' + gVar.valueUpdate.offset_page);\n\n\t};\n\n\n\n\n\t// API 地域名初期表示\n\t_farstPrefTitle(data){\n\t\tvar pref_title = data.pref[gVar.valueUpdate.pref_num].pref_name;\n\t\tjQuery('.pref_title').html(pref_title);\n\t};\n\n\t//現在の地域名を更新\n\t_changePrefTitle(data){\n\t\tjQuery('.pref_title').html(val);\t\t\n\t};\n\n\t//API 都道府県データをselect要素として生成する\n\t_dataPref(data){\n\t\tfor ( var i in data.pref ){\n\t\t\tvar name = data.pref[i].pref_name;\n\t\t\tvar code = data.pref[i].pref_code;\n\t\t\tjQuery(\"[name = pref_name]\").append( '<option value=\"' + code + '\">' + name + '</option>' );\n\t\t}\n\t};\n\n\n\n\n\n}\n\n\n\n\njQuery(function() {\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n\n\n/**\n *　API 初期設定\n */\n\n// API エンドポイントURL\ngVar.endPoints = {\n\trest : 'http://api.gnavi.co.jp/RestSearchAPI/20150630/?callback=?', //レストラン検索API\n\tpref : 'http://api.gnavi.co.jp/master/PrefSearchAPI/20150630/?callback=?', //エリアマスタ取得API\t\t\t\n};\n\n//API 基本パラメータ\ngVar.params = {\n\tkeyid: 'a6154b84e515ec01816a2abfe80fc329',\n\tformat: 'json'\n};\n\n// API 更新データ\ngVar.valueUpdate = {\n\toffset_page: 1, //ページ数初期化\n\tDataCountUp: 0, //取得したデータ数\n\tpref_num: 12 //都道府県名初期設定(12 = 東京)\n}\n\n//API オプションパラメータ\ngVar.paramsOpts　= {\n\t\n\tbase: {\n\t\tfreeword: 'コーヒー,カフェ,珈琲,喫茶,喫茶店', //キーワード設定\n\t\thit_per_page: 10, //表示件数\n\t\tpref: 'PREF' + (gVar.valueUpdate.pref_num + 1) //都道府県名初期設定(東京)\n\t}\n\n}\n\n\nconsole.log(gVar.valueUpdate.pref_num);\n\n\n/**\n *　\n */\nlet rest = new getAPIdata(gVar.params, gVar.paramsOpts.base);\nlet restParameter = rest._getParameter();\n\nlet pref = new getAPIdata(gVar.params);\n\n\n//ページがロードされたら\njQuery(window).one('load', function(){\n\n\tconsole.log('ページ数更新値： ' + gVar.valueUpdate.offset_page);\n\n\t/**\n\t * 店舗データを取得し表示する\n\t */\n\tjQuery.getJSON(gVar.endPoints.rest, restParameter, function(data){\n\n\t\t// 店舗件数を表示\n\t\trest._showResultNum(data, '.total');\n\n\t\t// 店舗データ表示\n\t\trest._getData(data);\n\n\t})\n\n\t//都道府県データを取得し表示/セットする\n\tjQuery.getJSON(gVar.endPoints.pref, gVar.params, function(data){\n\t\tconsole.log(data);\n\t\tpref._farstPrefTitle(data);\n\t\tpref._dataPref(data);\n\t})\n\n});\n\n\n\n//指定要素がクリックされたら次のデータを取得し表示する\njQuery('.btn--more-load').on('click', function(){\n\n\t// データを取得\n\tjQuery.getJSON(gVar.endPoints.rest, restParameter, function(data){\n\n\t\t// 店舗データ表示\n\t\trest._getData(data);\n\n\t\t// ページ数更新\n\t\tgVar.valueUpdate.offset_page++\n\n\n\t})\n\n});\n\n\n//--------------------------------------------------------------------------------------------------------------------------------------------------------------------\n});"]}